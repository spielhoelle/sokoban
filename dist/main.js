(()=>{"use strict";const t="empty",e="wall",s="block",i="success_block",o="void",l="player",r="up",n="down",c="left",a="right",h={[r]:"ArrowUp",[n]:"ArrowDown",[c]:"ArrowLeft",[a]:"ArrowRight",w:"w",a:"a",s:"s",d:"d"},d=75,f={empty:{fill:"#ded7b3",stroke:"#ded7b3"},wall:{fill:"#868687",stroke:"#505051"},block:{fill:"#d9ae0a",stroke:"#C79300"},success_block:{fill:"#4ccd5a",stroke:"#3ca448"},void:{fill:"#dfbbb1",stroke:"#ca8e7d"},player:{fill:"#4f99e8",stroke:"#3f7ab9"}},x=[[e,e,e,e,e,e],[e,t,o,s,l,e],[e,e,e,e,e,e]],b=t=>[s,i].includes(t),y=e=>[t,o].includes(e),v=t=>[o,i].includes(t),u=(t,e,s=1)=>"up"===e||"down"===e?t:"right"===e?t+s:"left"===e?t-s:void 0,k=(t,e,s=1)=>"left"===e||"right"===e?t:"down"===e?t+s:"up"===e?t-s:void 0;function m({level:t}){if(1===t)return JSON.parse(JSON.stringify(x))}function w(t,e,s,i,o){return b(o[e][s])?w(++t,k(e,i),u(s,i),i,o):t}const p=new class{constructor({level:t}){this.canvas=document.querySelector("canvas"),this.canvas.width=600,this.canvas.height=675,this.context=this.canvas.getContext("2d"),this.context.fillStyle=f.empty,this.context.fillRect(0,0,600,675),this.board=m({level:t})}paintCell(t,e,s,i){if("void"===e||"player"===e){const t="player"===e?20:10;this.context.beginPath(),this.context.rect(s*d,i*d,d,d),this.context.fillStyle=f.empty.fill,this.context.fill(),this.context.beginPath(),this.context.arc(s*d+37.5,i*d+37.5,t,0,2*Math.PI),this.context.lineWidth=10,this.context.strokeStyle=f[e].stroke,this.context.fillStyle=f[e].fill,this.context.fill(),this.context.stroke()}else this.context.beginPath(),this.context.rect(s*d+5,i*d+5,65,65),this.context.fillStyle=f[e].fill,this.context.fill(),this.context.beginPath(),this.context.rect(s*d+5,i*d+5,65,65),this.context.lineWidth=10,this.context.strokeStyle=f[e].stroke,this.context.stroke()}render(t={}){t.restart&&(this.board=m({level:1})),this.board.forEach(((t,e)=>{t.forEach(((t,s)=>{this.paintCell(this.context,t,s,e)}))}));const e=this.board.filter((t=>t.some((t=>t===o))));v(x[this.findPlayerCoords().y][this.findPlayerCoords().x])&&e.push(x[this.findPlayerCoords().y]);const s=this.board.filter((t=>t.some((t=>t===i))));0===e.length&&1===s.length&&(this.context.fillStyle="#111",this.context.fillRect(0,0,600,675),this.context.font="bold 60px sans-serif",this.context.fillStyle=f.success_block.fill,this.context.fillText("A Winner is You!",65,300))}findPlayerCoords(){const t=this.board.findIndex((t=>t.includes(l))),e=this.board[t].indexOf(l);return{x:e,y:t,above:this.board[t-1][e],below:this.board[t+1][e],sideLeft:this.board[t][e-1],sideRight:this.board[t][e+1]}}movePlayer(e,s){this.board[e.y][e.x]=v(x[e.y][e.x])?o:t,this.board[k(e.y,s,1)][u(e.x,s,1)]=l}movePlayerAndBoxes(t,o){const l=k(t.y,o,1),r=u(t.x,o,1),n=k(t.y,o,2),c=u(t.x,o,2);if(a=this.board[n][c],[e].includes(a))return;var a;let h=0;if(b(this.board[n][c])){h=w(1,n,c,o,this.board);const e=this.board[k(l,o,h)][u(r,o,h)];if(y(e)){for(let t=0;t<h;t++)this.board[k(n,o,t)][u(c,o,t)]=v(x[k(n,o,t)][u(c,o,t)])?i:s;this.movePlayer(t,o)}}else this.board[n][c]=v(x[n][c])?i:s,this.movePlayer(t,o)}move(t,e){const{x:s,y:i,above:o,below:l,sideLeft:h,sideRight:d}=t,f={[r]:o,[n]:l,[c]:h,[a]:d};y(f[e])&&this.movePlayer(t,e),b(f[e])&&this.movePlayerAndBoxes(t,e)}}({level:1});p.render({restart:!0}),document.addEventListener("keydown",(t=>{const e=p.findPlayerCoords();switch(t.key){case h.up:case h.w:p.move(e,r);break;case h.down:case h.s:p.move(e,n);break;case h.left:case h.a:p.move(e,c);break;case h.right:case h.d:p.move(e,a)}p.render()})),document.querySelector("button").addEventListener("click",(t=>{p.render({restart:!0})}))})();